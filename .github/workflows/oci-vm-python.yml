name: Launch OCI Free-Tier VM

on:
  workflow_dispatch:

jobs:
  launch-vm:
    runs-on: ubuntu-latest

    steps:
      - name: üîß Install OCI CLI
        run: |
          curl -L https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh > install.sh
          bash install.sh --accept-all-defaults

      - name: ‚è≥ Launching free-tier VM...
        run: |
          echo "‚è≥ Launching free-tier VM..."
          ~/.oci/bin/oci compute instance launch \
            --availability-domain ${{ secrets.OCI_AD }} \
            --compartment-id ${{ secrets.OCI_COMPARTMENT_ID }} \
            --shape VM.Standard.E2.1.Micro \
            --display-name github-actions-vm \
            --image-id ${{ secrets.OCI_IMAGE_ID }} \
            --subnet-id ${{ secrets.OCI_SUBNET_ID }} \
            --assign-public-ip true \
            --metadata '{"ssh_authorized_keys":"${{ secrets.OCI_SSH_PUBLIC_KEY }}"}' \
            --region ${{ secrets.OCI_REGION }}
